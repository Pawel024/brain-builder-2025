{
  "schemaVersion": 2,
  "captainVersion": "1.0",
  "description": "Django and React application",
  "language": "python-django",
  "dockerfileLines": [
    "FROM node:14 AS build",
    "WORKDIR /app",
    "COPY ./frontend /app/frontend",
    "WORKDIR /app/frontend",
    "RUN npm install",
    "RUN NODE_OPTIONS=\"--max_old_space_size=4096\" npm run build",
    "RUN npm prune --production",
    
    "FROM python:3.10-slim",
    "WORKDIR /app",
    "COPY . /app",
    "COPY --from=build /app/frontend/build /app/frontend/build",
    "RUN apt-get update && apt-get install -y libpq-dev",
    "RUN pip install -r requirements.txt",
    "RUN python manage.py collectstatic --noinput",
    "CMD daphne django_react_proj.asgi:application --port $PORT --bind 0.0.0.0 -u none"
  ],
  "caproverOneClickApp": {
    "instructions": {
      "start": "python manage.py migrate && /app/bin/start-pgbouncer && daphne django_react_proj.asgi:application --port $PORT --bind 0.0.0.0 -u none"
    }
  }
}